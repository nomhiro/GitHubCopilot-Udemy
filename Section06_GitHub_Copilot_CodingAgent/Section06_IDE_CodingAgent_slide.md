---
marp: true
theme: custom-theme
paginate: true
---

<!-- _class: title -->
<!-- _paginate: false -->

# IDEでのGitHub Copilot活用とコーディングエージェント

---

# このセクションで学ぶこと

- IDEへのGitHub Copilotインストールと設定
- コード補完機能とインライン提案の操作
- GitHub MCP ServerによるAIワークフローの強化
- コーディングエージェントの概要と有効化
- セキュリティ、リスク、制限事項
- タスクの割り当て、追跡、問題解決
- カスタマイズ、拡張、検証

# コーディングエージェントの概要と有効化

---

# GitHub Copilot コーディングエージェントとは

GitHub 自体で実行される**自律開発アシスタント**

## コーディングエージェントができること

| タスク | 説明 |
|--------|------|
| バグ修正 | バグと回帰を修正 |
| 機能実装 | 段階的な新機能を実装 |
| テスト生成 | テストカバレッジを改善、不足しているテストを生成 |
| ドキュメント | ドキュメントを更新または作成 |
| 技術的負債 | バックログ項目に対処 |

---

# コーディングエージェント vs エージェントモード

| 項目 | コーディングエージェント | エージェントモード |
|------|------------------------|-------------------|
| **動作場所** | GitHub.com（クラウド） | IDE（ローカル） |
| **実行環境** | GitHub Actions環境 | IDEセッション |
| **出力** | Pull Request を作成 | ローカルファイル編集 |
| **透明性** | コミット履歴で追跡可能 | プライベートセッション |
| **対話方法** | PRコメントで反復 | IDE内で直接対話 |

<span class="red">試験ポイント: コーディングエージェント=GitHub.com、エージェントモード=IDE</span>

---

# 利用可能なプランとリポジトリ

## 対応プラン
- Copilot Pro / Pro+
- Copilot Business
- Copilot Enterprise

## リポジトリ要件
- GitHub でホストされているリポジトリでのみ動作
- マネージドユーザーアカウント所有のリポジトリでは使用不可
- 明示的に無効化されていないリポジトリ

---

# タスクを委任する方法

## 1. Issue を Copilot に割り当て
- GitHub.com
- GitHub Mobile
- API/CLI

## 2. Pull Request を作成するよう依頼
- GitHub の「エージェント」パネル
- Copilot Chat
- MCP をサポートする IDE

---

# コスト（GitHub Actions + PRU）

コーディングエージェントは2つのリソースを使用

| リソース | 説明 |
|---------|------|
| **GitHub Actions の実行時間** | エージェントが動作する一時的なビルド・テスト環境 |
| **Premium Request Units (PRU)** | 高度なモデル推論用（モデル要求ごとに1 PRU） |

> 毎月のアクションと Premium 要求の許容量内で、追加料金なしでタスクを実行可能

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# セキュリティ、リスク、制限事項

---

# 組み込みの保護機能

| 保護機能 | 説明 |
|---------|------|
| **ガバナンスの対象** | 組織と企業の設定によって可用性が管理される |
| **制限付き環境** | GitHub Actions 上のサンドボックス内で実行 |
| **ブランチの制限** | `copilot/` で始まるブランチのみ作成・プッシュ可能 |
| **アクセス許可対応** | 書き込みアクセス許可を持つユーザーにのみ応答 |
| **外部コラボレータールール** | 下書き PR では書き込みアクセス許可を持つユーザーによる承認が必要 |
| **コンプライアンスと属性** | すべてのコミットはタスクを割り当てた開発者と共同編集 |

<span class="red">試験ポイント: copilot/で始まるブランチのみ作成可能</span>

---

# リスクと軽減策

## リスク1: エージェントがコードをプッシュする
- 書き込みアクセス権を持つユーザーのみがトリガー可能
- プッシュは `copilot/` ブランチに制限
- Actions ワークフローは書き込みアクセス許可ユーザーが承認するまで実行されない
- 要求元は自身のエージェント PR を承認できない

## リスク2: プロンプトインジェクション
- 非表示の文字（HTML コメントなど）はフィルター処理

---

# 既知の制限事項

| 制限 | 説明 |
|------|------|
| リポジトリスコープ | 割り当てられた問題と同じリポジトリでのみ変更可能 |
| PR 数 | タスクごとに 1 つの Pull Request のみ |
| 既存 PR | 自分が作成していない既存の PR を変更することはできない |
| コミット署名 | コミットに署名しない |
| ランナー | GitHub でホストされる Ubuntu x64 ランナーが必要 |
| モデル選択 | 使用される AI モデルを変更できない |

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# タスクの割り当て、追跡、問題解決

---

# Issue割り当て時のエージェント動作フロー

1. Issue に対する 👀 の反応を追加（確認）
2. 専用の `copilot/` ブランチを作成
3. Issue にリンクされた**下書き Pull Request** を開く
4. GitHub Actions を利用した環境内でエージェントセッションを開始
5. コミットをブランチにプッシュし、PR 本文をステータスメッセージで更新
6. 完了時に「Copilot finished work」イベントを投稿し、レビューを要求

<span class="red">試験ポイント: 最初に👀の反応が追加される</span>

---

# 割り当て方法

## GitHub.com での割り当て
1. リポジトリの「Issues」タブに移動
2. 委任する Issue を開く
3. 右側のサイドバーの「Assignees」で「Copilot」を選択

## GitHub CLI での割り当て
```bash
gh issue edit <issue-number> --add-assignee copilot
```

---

# 進行状況の追跡

| フェーズ | 確認方法 |
|---------|---------|
| **即時確認** | Issue に 👀 の反応が追加される |
| **下書き PR 作成** | Issue のタイムラインに新しいイベントが表示 |
| **アクティブセッション** | PR タイムラインに「Copilot started work」が表示 |
| **ライブセッションログ** | 「エージェント」ページから過去および現在のセッションを表示 |
| **完了** | PR タイムラインに「Copilot finished work」が表示 |

---

# @copilot による反復処理

Pull Request コメントで `@copilot` をメンションすることで、作業を反復処理できる

## 注意点
- リポジトリへの**書き込みアクセス許可**を持つユーザーからのコメントのみ処理される
- Copilot はコメントに 👀 の反応を投稿して要求を受信したことを確認

## 承認とワークフロー
- Copilot が作成した PR は常に**ドラフト状態**
- マージ前に**人による承認が必要**
- GitHub Actions ワークフローは自動実行されない

---

# トラブルシューティング

| 問題 | 対処法 |
|------|--------|
| 「Assignees」リストにCopilotがない | 対象プラン（Pro, Pro+, Business, Enterprise）を確認 |
| Issue割り当て後に何も起こらない | 👀 反応があるか確認、ドラフト PR を確認 |
| エージェントがPRコメントに応答しない | 書き込みアクセス権を確認、@copilotがメンションされているか確認 |
| スタックしているように見える | セッションは**1時間後**にタイムアウト |
| Actionsが実行されない | 「承認してワークフローを実行」をクリック |

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# カスタマイズ、拡張、検証

---

# copilot-setup-steps.yml の作成

リポジトリの既定のブランチに `.github/workflows/copilot-setup-steps.yml` を作成

```yaml
name: "Copilot Setup Steps"

on:
  workflow_dispatch:

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Set up Node.js
        uses: actions/setup-node@v4
```

---

# 許可されている構成キー

| キー | 説明 |
|------|------|
| `steps` | 実行するステップ |
| `permissions` | 権限設定 |
| `runs-on` | 実行ランナー（Ubuntu x64 ランナーのみ） |
| `container` | コンテナ設定 |
| `services` | サービス設定 |
| `snapshot` | スナップショット |
| `timeout-minutes` | タイムアウト（**最大59分**） |

---

# MCPによる拡張

MCP は、ツールとデータに LLM を接続するためのオープンな標準

## 既定の MCP サーバー

| サーバー | 機能 |
|---------|------|
| **GitHub MCP サーバー** | Issue、PR、GitHub データにアクセス（読み取り専用トークン使用） |
| **Playwright MCP サーバー** | Web ページの読み取り、操作、スクリーンショット取得 |

## 注意点
- OAuthを必要とするリモートMCPサーバーは非対応

---

# 検証のベストプラクティス

| プラクティス | 説明 |
|-------------|------|
| **CI を実行** | すべてのエージェント PR でテスト、リンター、スキャンを実行 |
| **手動検査** | 影響の大きい領域や機密性の高い領域を手動で検査 |
| **テスト生成を依頼** | 例: "Add Jest unit tests for all functions in src/utils/" |
| **ルールセット適用** | エージェント PR がテストに合格することを必須に |
| **ラベル付け** | エージェント PR にラベルを付けて監視・トリアージ |
| **命令を反復** | 繰り返しミスがある場合は `.github/copilot-instructions.md` を更新 |

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# 責任ある使用とベストプラクティス

---

# エージェントのしくみ（エンドツーエンド）

1. **プロンプト処理**
   - Issue、PR コメント、または Copilot Chat メッセージからタスクを取得
   - 入力形式: 自然言語、コードスニペット、画像

2. **言語モデルの分析**
   - プロンプトを大規模言語モデルで分析
   - タスクの理由付けと必要なツールの活用

---

# 活用事例

| ユースケース | 説明 |
|-------------|------|
| **コードベースのメンテナンス** | セキュリティ修正、依存関係アップグレード、リファクタリング |
| **ドキュメント** | ドキュメントの更新と新規作成 |
| **機能開発** | 機能リクエストの段階的な実現 |
| **テストカバレッジ改善** | 追加のテストスイート開発 |
| **プロトタイプ作成** | 新しい概念のグリーンフィールド開発 |

---

# パフォーマンス向上のコツ

## タスクのスコープを適切に設定
以下の情報を提供してください：
- 解決すべき問題または必要な作業の明確な説明
- 適切なソリューションの受け入れ基準（単体テストが必要かなど）
- 変更する必要があるファイルに関するヒント

## カスタム命令の追加
`.github/copilot-instructions.md` を追加して、エージェントが変更をビルド、テスト、検証する方法を理解できるようにする

---

# セキュリティ対策

## 特権エスカレーションの回避
- 書き込みアクセス権を持つユーザーからの対話にのみ応答
- エージェント PR によるアクション ワークフローは承認が必要
- 非表示の文字はフィルター処理

## Copilot のアクセス許可の制約
- PR を作成しているリポジトリにのみアクセス
- プッシュは `copilot/` で始まるブランチに限定
- 組織/リポジトリのシークレットにはアクセス不可

---

# 制限事項の理解

| 制限 | 説明 |
|------|------|
| **限られた範囲と品質** | 特定のコード構造や言語での品質差 |
| **潜在的なバイアス** | トレーニングデータによるバイアスの可能性 |
| **セキュリティリスク** | レビューされない場合は機密情報を公開する可能性 |
| **不正確なコード** | 意味的/構文的に間違っている可能性 |
| **パブリックコード** | 参照が提供されない場合あり |

---

# まとめ

## IDEでのGitHub Copilot活用
- **Tab**キーで提案を受け入れ、**Alt+]**で次の提案
- **Ctrl+I**でインラインチャット起動
- MCPでAIワークフローを強化

## コーディングエージェント
- **GitHub.com**でバックグラウンド実行（エージェントモードはIDE）
- **copilot/**で始まるブランチに**ドラフトPR**を作成
- 書き込みアクセス権を持つユーザーからの指示にのみ応答
- セッションは**1時間**でタイムアウト

---

# 試験対策ポイント

| トピック | 重要ポイント |
|---------|-------------|
| 提案の受け入れ | **Tab**キー |
| 次の提案表示 | **Alt+]**（Win）/ **Option+]**（Mac） |
| インラインチャット | **Ctrl+I**（Win）/ **Cmd+I**（Mac） |
| コーディングエージェントの動作場所 | **GitHub.com**（クラウド） |
| エージェントが作成するブランチ | **copilot/**で始まるブランチ |
| PRの状態 | 常に**ドラフト**状態 |
| 最初の確認 | **👀**の反応 |
| セッションタイムアウト | **1時間** |
