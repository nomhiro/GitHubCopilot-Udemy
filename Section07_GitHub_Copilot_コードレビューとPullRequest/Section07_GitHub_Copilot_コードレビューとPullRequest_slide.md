---
marp: true
theme: custom-theme
paginate: true
---

<!-- _class: title -->
<!-- _paginate: false -->

# GitHub Copilot
# コードレビューとPull Request

---

# このセクションで学ぶこと

- コードレビューでCopilotの主な機能を特定できる
- GitHub.comでCopilotをレビュー担当者として使用できる
- PRサマリーの自動生成とデータ書式設定を理解する
- カスタムレビュー手順の設定方法を把握する
- 自動レビューの設定とスケーリング方法を理解する
- PRU（Premium Request Units）の最適化を実践できる

---

# 対応プラン

| 機能 | Free | Pro | Business | Enterprise |
|------|:----:|:---:|:--------:|:----------:|
| 基本的なPRサマリー | - | ○ | ○ | ○ |
| Copilotによるコードレビュー | - | ○ | ○ | ○ |
| 自動レビュー設定（個人） | - | ○ | - | - |
| 自動レビュー設定（組織） | - | - | ○ | ○ |
| カスタムレビュー手順 | - | - | ○ | ○ |

<span class="red">試験ポイント: FreeプランではCopilotによるコードレビュー機能は利用不可</span>

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# Copilotによるコードレビューの概要

---

# コードレビューの課題

コードレビューとPull Requestレビューは品質に不可欠ですが...

- **時間がかかる** - 複数のファイルを確認する必要がある
- **不均等になりがち** - レビュー担当者によって品質がばらつく
- **複数の言語への対応** - 言語ごとの規則を把握する必要がある
- **大きな差分の処理** - 大量の変更を一度に確認するのは困難

GitHub Copilotは**共同作業レビュー担当者とアシスタント**として機能し、このワークロードを軽減します。

---

# コードレビューにおけるCopilotの主な機能

| 機能 | 説明 |
|------|------|
| **PRの概要** | 変更の明確な概要と影響を受けるファイル一覧を自動作成 |
| **セキュリティ修正** | GitHub Code Scanningと統合し、脆弱性にフラグを設定 |
| **行ごとの説明** | コードを強調表示し、機能の説明を依頼可能 |
| **コメントの下書き** | ベストプラクティスに基づくレビューコメントを生成 |
| **IDEでのレビュー** | PR作成前にIDE内でコードをレビュー |

<span class="red">ポイント: Copilotは「アドバイザリ」として機能し、PRの承認や拒否はしない</span>

---

# セキュリティ修正の例

Copilotはセキュリティリスクを検出し、具体的な修正を提案します。

**危険なコード:**
```javascript
// ユーザー入力を使ったeval()はコードインジェクションの危険性
eval(userInput);
```

**Copilotの提案:**
```javascript
// 安全なパーサーに置き換え
const data = JSON.parse(userInput);
```

<span class="red">ポイント: eval()やexec()の危険性を検出し、安全な代替案を提案</span>

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# コードレビューでのCopilot提案の活用

---

# 提案の取得方法

Pull Requestをレビューするとき、改善できる可能性がある領域をCopilotが支援します。

1. Pull Requestの「**ファイルが変更されました**」ビューを開く
2. コードの**行またはブロックを強調表示**
3. Copilotに**改善を提案**するか、潜在的な問題にフラグを付けるよう依頼
4. Copilotが**具体的なコンテキストに対応した提案**を生成

---

# GitHub.comでのCopilotレビュー担当者の使用

| ステップ | 内容 |
|---------|------|
| 1 | **Pull Requestを開くか作成する** |
| 2 | **[校閲者]メニュー**から**[Copilot]**を選択 |
| 3 | レビュー完了を待つ（**通常30秒未満**） |
| 4 | Copilotのコメントを確認（関連するコード行に表示） |
| 5 | 推奨される変更をPRインターフェースから直接コミット |

---

# Copilotレビューの制限

Copilotのレビューにおける役割は**アドバイザリ**です。

- Pull Requestを**承認も拒否もしない**
- コメントは**必須の承認にカウントされない**
- 問題の早期発見と実用的な提案の生成に使用
- **アーキテクチャの決定**、**最終的なサインオフ**は人間が行う

<span class="red">試験ポイント: Copilotは必須の承認としてカウントされない</span>

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# PRサマリー生成

---

# PR概要の生成手順

PRの説明を書くことは多くの場合ハードルに感じますが、Copilotで簡単になります。

1. PR説明エディターを開く
2. **Copilotアイコン**をクリック
3. 下書きの概要またはアウトラインを生成
4. 必要に応じて編集

**生成される内容:**
- 変更の明確な概要
- 影響を受けるファイルの一覧
- 主要な変更点のハイライト

---

# PRU消費量の目安

PR概要の生成と高度なPull Request支援機能では**PRU**が使用されます。

| 操作 | PRU消費量 |
|------|----------|
| PRサマリー生成 | 1〜2 PRU（変更の複雑さに依存） |
| コードレビュー要求 | 1〜3 PRU（分析の範囲に依存） |

**ベストプラクティス:**
- 毎月の許容量内に収まるよう使用状況を監視
- 複雑なPRは分割してレビュー効率を向上

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# カスタムレビュー手順とセキュリティ修正

---

# PRUによる高度なレビュー機能

PRU（Premium Request Units）は高度なレビュー機能を強化します。

| 機能 | 説明 |
|------|------|
| **PRレビュー担当者としてのCopilot** | Copilotをレビュー担当者として割り当て |
| **カスタムレビュー手順** | チームルールに合わせた調整 |
| **詳細なコード分析** | 読みやすさ、セキュリティ、スタイルの重点分析 |

---

# カスタムレビュー手順の設定

<span class="red">`.github/copilot-instructions.md` ファイルでCopilotをカスタマイズできます。</span>

```markdown
# Copilot レビュー手順

## コードスタイル
- インデントは2スペースを使用
- 変数名はキャメルケースを使用

## セキュリティ
- ユーザー入力は必ず検証する
- eval()やexec()の使用を避ける
```

---

# Copilotなしとありの比較

**Copilotなしの場合:**
> 「ここでセキュリティの問題を修正する」

（あいまいなコメント）

**Copilot + PRUの場合:**
> 「`exec()`を使用すると、コードインジェクションの脆弱性が発生します。`subprocess.run()`に置き換えることを検討してください。推奨パッチ:」

（具体的で実用的なフィードバック + コード修正をインライン提供）

---

# セキュリティ修正機能

Copilotコードレビューは、GitHub Code Scanningと統合されると脆弱性にフラグを設定します。

| 言語 | 検出可能な脆弱性例 |
|------|-------------------|
| **JavaScript** | eval()への未承認入力、XSS脆弱性 |
| **Python** | exec()、pickle.loads()の危険な使用 |
| **SQL** | SQLインジェクション |
| **その他** | OWASP Top 10の各種脆弱性 |s

---

<!-- _class: lecture -->
<!-- _paginate: false -->

# 自動レビューの設定とスケーリング

---

# IDEでのCopilotローカルレビュー

VS CodeまたはJetBrains IDEで**コミットする前に変更を確認**できます。

| メリット | 説明 |
|---------|------|
| **早期発見** | スタイル違反、セキュリティのギャップを早期に発見 |
| **サイクル短縮** | レビュープロセスのサイクルを節約 |
| **品質向上** | ベストプラクティスの問題に事前対処 |

<span class="red">試験ポイント: IDEでのレビューはPR作成前に問題をキャッチできる</span>

---

# パス固有のカスタム指示

`.github/instructions` フォルダで特定のファイルやフォルダのレビューをガイドできます。

| ステップ | 内容 |
|---------|------|
| 1 | `.github/instructions` フォルダを作成 |
| 2 | `.instructions.md` で終わるファイルを作成 |
| 3 | `applyTo` キーワードで適用パスを定義 |
| 4 | Markdownでレビューガイダンスを記述 |

---

# applyToキーワードの例

```yaml
# Rubyモデルに適用
applyTo: "app/models/**/*.rb"

# TypeScriptファイルに適用
applyTo: "**/*.ts,**/*.tsx"

# リポジトリ内のすべてのファイルに適用
applyTo: "**"
```

<span class="red">試験ポイント: パス固有の指示には `applyTo` キーワードを使用</span>

---

# ルールセットを使用した自動レビュー

GitHubでは**ブランチルールセット**を構成して、保護されたブランチを対象とするすべてのPRにCopilotを自動的に割り当てできます。

| コンポーネント | 役割 |
|--------------|------|
| **Copilotレビュー** | スタイルと読みやすさを確認 |
| **コードスキャン** | 脆弱性を検出 |
| **テスト** | 機能を検証 |

<span class="red">試験ポイント: 自動レビューにはブランチルールセットを使用</span>

---

# アカウントの自動レビュー設定

個人のCopilot設定で自動レビューを有効にできます。

**対象プラン:** Copilot Pro または Copilot Pro+

**設定手順:**
1. GitHubページの右上隅にあるプロファイル画像をクリック
2. 「自分のCopilot」を選択
3. 「自動コパイロットコードレビュー」のオプションを見つける
4. ドロップダウンから「有効」を選択

<span class="red">試験ポイント: 個人の自動レビューはPro/Pro+プランのみ利用可能</span>

---

# リポジトリの自動レビュー設定

リポジトリ管理者がブランチルールセットを作成して設定できます。

| ステップ | 操作 |
|---------|------|
| 1 | リポジトリで「設定」をクリック |
| 2 | 「コードと自動化」→「ルール」→「ルールセット」を選択 |
| 3 | 「新しい分岐ルールセット」をクリック |
| 4 | 名前を入力し、「強制状態」を「アクティブ」に設定 |
| 5 | 「Copilotからpull requestレビューを要求する」を選択 |

---

# 組織全体の自動レビュー設定

大規模なチームでは、複数のリポジトリに一度にスケーリングできます。

**設定のポイント:**
- 名前パターンまたは包含/除外規則でリポジトリを指定
- 例: `*service` で全サービスリポジトリに適用

**メリット:**
- 一貫した標準を保証
- 組織全体のレビュー時間を短縮
- 気付かれていない回帰のリスクを軽減

---

# まとめ

- Copilotは**コードレビューの負担を軽減**する協力的なアシスタント
- **[校閲者]メニュー**からCopilotをレビュー担当者として追加
- レビューは**30秒未満**で完了、役割は**アドバイザリ**
- **`.github/copilot-instructions.md`** でカスタムレビュー手順を設定
- **`.github/instructions`** でパス固有のカスタム指示を設定
- **ブランチルールセット**で自動レビューをスケーリング
- **PRU**を戦略的に使用して最大の効果を得る

